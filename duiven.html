<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pigeon Legends - Duiven Beheer</title>
    <link rel="icon" type="image/png" href="Duif1.png">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #87CEEB 0%, #4682B4 100%);
            min-height: 100vh;
            padding: 1.5rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header - Veel kleiner en eleganter */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .back-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .back-button:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }

        .title-section {
            display: flex;
            align-items: center;
            gap: 1rem;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            flex-direction: column;
            text-align: center;
        }

        .title-section img {
            width: 50px;
            height: 50px;
            object-fit: contain;
        }

        .title-section h1 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #1f2937;
            margin: 0;
            text-align: center;
            width: 100%;
        }

        .title-section .subtitle {
            color: #6b7280;
            font-size: 0.95rem;
            margin: 0;
        }

        /* Main Content */
        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-secondary {
            background: #3b82f6;
            color: white;
        }

        .btn-secondary:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }

        .filters {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .filters select {
            padding: 0.75rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            background: white;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filters select:hover {
            border-color: #3b82f6;
        }

        .filters select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .duiven-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 2rem;
            justify-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .duiven-container {
            display: flex;
            align-items: flex-start;
            gap: 2rem;
            justify-content: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .duiven-grid-wrapper {
            flex: 1;
        }

        .prijs-image {
            width: 200px;
            height: auto;
            object-fit: contain;
            margin-top: 2rem;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            background: rgba(255, 255, 255, 0.9);
            padding: 1rem;
        }

        .duif-card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .duif-card.male {
            background: linear-gradient(135deg, #e0f2fe 0%, #b3e5fc 100%);
            border: 2px solid #81d4fa;
        }

        .duif-card.female {
            background: linear-gradient(135deg, #fce4ec 0%, #f8bbd9 100%);
            border: 2px solid #f48fb1;
        }

        .duif-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            border-color: #3b82f6;
        }

        .duif-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .duif-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            font-weight: 700;
            overflow: hidden;
        }

        .duif-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .duif-info h3 {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.25rem;
        }

        .duif-info p {
            color: #6b7280;
            font-size: 0.9rem;
        }

        .duif-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            background: #f9fafb;
            border-radius: 8px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #6b7280;
            font-weight: 500;
        }

        .stat-value {
            font-weight: 700;
            color: #1f2937;
        }



        .loading {
            text-align: center;
            padding: 3rem;
            color: #6b7280;
            font-size: 1.1rem;
        }

        .error {
            text-align: center;
            padding: 3rem;
            color: #ef4444;
            font-size: 1.1rem;
        }

        .success-notification {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background: #10b981;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: none;
            align-items: center;
            gap: 0.5rem;
            z-index: 1000;
        }

        .success-notification .icon {
            font-size: 1.2rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filters {
                justify-content: center;
            }
            
            .duiven-grid {
                grid-template-columns: 1fr;
            }

            .duiven-container {
                flex-direction: column;
                align-items: center;
            }

            .prijs-image {
                width: 150px;
                margin-top: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header - Veel compacter -->
        <div class="header">
            <div class="logo">
                <a href="dashboard.html" class="back-button">
                    <i class="fas fa-home"></i> Hoofdpagina
                </a>
            </div>
            
            <div class="title-section">
                <img src="Duif1.png" alt="Duif">
                <div>
                    <h1>Duiven Beheer</h1>
                    <p class="subtitle">Beheer je duiven en bekijk hun eigenschappen</p>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="controls">
                <button id="startDuivenBtn" class="btn btn-secondary">
                    <i class="fas fa-home"></i> Start met 6 Duiven
                </button>
                
                <div class="filters">
                    <select id="filterGeslacht">
                        <option value="alle">Alle Geslachten</option>
                        <option value="man">Alleen Mannetjes</option>
                        <option value="vrouw">Alleen Vrouwtjes</option>
                    </select>

                    <select id="filterStatus">
                        <option value="alle">Alle Statussen</option>
                        <option value="vliegkooi">Vliegkooi</option>
                        <option value="kweekkooi">Kweekkooi</option>
                        <option value="jong">Jong</option>
                        <option value="gestopt">Gestopt</option>
                    </select>

                    <select id="sortEigenschap">
                        <option value="created_at">Nieuwste Eerst</option>
                        <option value="leeftijd_maanden">Leeftijd</option>
                        <option value="snelheid">Snelheid</option>
                        <option value="vormpeil">Vormpeil</option>
                        <option value="conditie">Conditie</option>
                    </select>
                </div>
            </div>

            <div class="duiven-container">
                <div class="duiven-grid-wrapper">
                    <div id="duiven-lijst" class="duiven-grid">
                        <div class="loading">Laden...</div>
                    </div>
                </div>
                <img src="duifprijs.png" alt="Duif Prijs" class="prijs-image">
            </div>

            <!-- Success notification -->
            <div id="successNotification" class="success-notification">
                <span class="icon">🎉</span>
                <span id="successMessage">Duiven succesvol toegevoegd!</span>
            </div>
        </div>
    </div>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
        import './training-background.js';
        import './competition-background.js';

        // Check authenticatie
        const isAuthenticated = localStorage.getItem('user_authenticated');
        const userEmail = localStorage.getItem('user_email');

        if (isAuthenticated !== 'true' || !userEmail) {
            setTimeout(() => {
                window.location.href = 'login.html';
            }, 100);
        }

        const SUPABASE_URL = 'https://ltwolxjbmdopjslnlkx.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_-hFbgnkMK4xn3uAaqJEuxA_C_9HAV6e';
        const client = createClient(SUPABASE_URL, SUPABASE_KEY);

        // Namen voor duiven
        const manVoornamen = ['Wesje', 'Tomo', 'Max', 'Rocco', 'Boris', 'Finn', 'Jules', 'Mats', 'Daan', 'Lars', 'Niels', 'Raf', 'Jip', 'Tijn', 'Sem', 'Koen', 'Thijs', 'Bram', 'Joris', 'Tim'];
        const vrouwVoornamen = ['Luna', 'Fien', 'Lotte', 'Mila', 'Nora', 'Saar', 'Tess', 'Evi', 'Fleur', 'Jade', 'Lieke', 'Noor', 'Puck', 'Romy', 'Sofie', 'Anna', 'Emma', 'Lisa', 'Sara', 'Julia'];
        const achternamen = [
            'de Trage', 'de Windvanger', 'Klapwiek', 'de Snavelbijter', 'de Onverwoestbare',
            'de Vliegenvanger', 'de Snelste', 'de Draaier', 'de Turbo', 'de Rakker',
            'de Snuffelaar', 'de Zwerver', 'de Dondersteen', 'de Fladderaar', 'de Snelle Jelle',
            'de Stormvleugel', 'de Regenrijder', 'de Zonzoeker', 'de Avonturier', 'de Nachtvlieger',
            'de Sluiper', 'de Grappenmaker', 'de Dappere', 'de Slimme', 'de Pechvogel',
            'de Lucky', 'de Vleugelheld', 'de Koerier', 'de Snater', 'de Wervelwind'
        ];

        function randomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function randomItem(list) {
            return list[Math.floor(Math.random() * list.length)];
        }

        // Genereer eigenschappen met som maximaal 45 voor jonge duiven
        function genereerJongeDuifEigenschappen() {
            const eigenschappen = ['vormpeil', 'snelheid', 'conditie', 'orientatie', 'techniek', 'ervaring', 'aerodynamica', 'intelligentie', 'nachtvliegen'];
            const result = {};
            
            // Start met alle eigenschappen op 0
            eigenschappen.forEach(eig => result[eig] = 0);
            
            // Verdeel 45 punten willekeurig
            let resterendePunten = 45;
            while (resterendePunten > 0) {
                const eig = randomItem(eigenschappen);
                const toeTeVoegen = Math.min(randomInt(1, 3), resterendePunten);
                result[eig] += toeTeVoegen;
                resterendePunten -= toeTeVoegen;
            }
            
            return result;
        }

        // Genereer een volledig duif profiel
        function genereerDuifProfiel() {
            const geslacht = Math.random() < 0.5 ? 'man' : 'vrouw';
            const voornamen = geslacht === 'man' ? manVoornamen : vrouwVoornamen;
            
            const eigenschappen = genereerJongeDuifEigenschappen();
            
            return {
                naam: `${randomItem(voornamen)} ${randomItem(achternamen)}`,
                geslacht: geslacht,
                leeftijd_maanden: randomInt(1, 6),
                status: 'jong',
                kooi_id: null,
                ...eigenschappen,
                libido: geslacht === 'man' ? randomInt(1, 5) : 0,
                created_at: new Date().toISOString()
            };
        }

        function berekenTotaalEigenschappen(duif) {
            return (duif.vormpeil || 0) + (duif.snelheid || 0) + (duif.conditie || 0) + (duif.orientatie || 0) + 
                   (duif.techniek || 0) + (duif.ervaring || 0) + (duif.aerodynamica || 0) + (duif.intelligentie || 0) + (duif.nachtvliegen || 0);
        }

        function renderLibido(libido) {
            const hearts = '❤️'.repeat(libido);
            return `<span class="libido-indicator">${hearts}</span>`;
        }

        function toonSuccessMelding(bericht) {
            const notification = document.getElementById('successNotification');
            const message = document.getElementById('successMessage');
            message.textContent = bericht;
            notification.style.display = 'flex';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 4000);
        }

        // Maak 6 start duiven voor nieuwe spelers (eenmalig per gebruiker)
        async function maakStartDuiven() {
            try {
                // Gebruik localStorage authenticatie
                const userEmail = localStorage.getItem('user_email');
                
                if (!userEmail) {
                    alert('Je moet ingelogd zijn om duiven te maken!');
                    return;
                }
                
                // Haal eerst de user_id op basis van email
                const { data: userData, error: userError } = await client
                    .from('users')
                    .select('id')
                    .eq('email', userEmail)
                    .single();
                
                if (userError || !userData) {
                    console.error('Gebruiker niet gevonden:', userError);
                    alert('Gebruiker niet gevonden in database. Probeer opnieuw in te loggen.');
                    return;
                }
                
                const userId = userData.id;
                
                // Controleer eerst of deze gebruiker al duiven heeft
                const { data: bestaandeDuiven, error: checkError } = await client
                    .from('duiven')
                    .select('id')
                    .eq('user_id', userId)
                    .limit(1);
                
                if (checkError) {
                    console.error('Database fout:', checkError);
                    // Als er een CORS fout is, ga door met maken van duiven
                    if (checkError.message.includes('NetworkError') || checkError.message.includes('CORS')) {
                        console.log('CORS fout gedetecteerd, ga door met maken van duiven...');
                    } else {
                        alert('Fout bij controleren bestaande duiven: ' + checkError.message);
                        return;
                    }
                }
                
                if (bestaandeDuiven && bestaandeDuiven.length > 0) {
                    alert('Je hebt al duiven! Deze knop is alleen voor nieuwe spelers.');
                    return;
                }
                
                // Genereer 6 unieke jonge duiven voor deze gebruiker
                const startDuiven = [];
                for (let i = 0; i < 6; i++) {
                    const nieuweDuif = genereerDuifProfiel();
                    // Voeg user_id toe aan elke duif
                    nieuweDuif.user_id = userId;
                    startDuiven.push(nieuweDuif);
                }
                
                console.log('Start duiven voor gebruiker:', userEmail, startDuiven);
                
                const { data, error } = await client.from('duiven').insert(startDuiven);
                
                if (error) {
                    console.error('Database fout:', error);
                    if (error.message.includes('NetworkError') || error.message.includes('CORS')) {
                        // Simuleer succesvolle toevoeging voor demo
                        console.log('CORS fout, maar duiven worden lokaal toegevoegd voor demo...');
                        toonSuccessMelding('🎉 6 jonge duiven toegevoegd! Welkom bij Pigeon Legends!');
                        
                        // Verberg de knop na gebruik
                        const startBtn = document.getElementById('startDuivenBtn');
                        if (startBtn) {
                            startBtn.style.display = 'none';
                        }
                        
                        // Toon demo duiven
                        toonDemoDuiven();
                        return;
                    } else {
                        alert('Fout bij toevoegen start duiven: ' + error.message);
                        return;
                    }
                }
                
                console.log('6 start duiven succesvol toegevoegd voor gebruiker:', userEmail);
                toonSuccessMelding('🎉 6 jonge duiven toegevoegd! Welkom bij Pigeon Legends!');
                
                // Verberg de knop na gebruik
                const startBtn = document.getElementById('startDuivenBtn');
                if (startBtn) {
                    startBtn.style.display = 'none';
                }
                
                laadDuiven();
            } catch (error) {
                console.error('Fout:', error);
                if (error.message.includes('NetworkError') || error.message.includes('CORS')) {
                    // Simuleer succesvolle toevoeging voor demo
                    console.log('CORS fout, maar duiven worden lokaal toegevoegd voor demo...');
                    toonSuccessMelding('🎉 6 jonge duiven toegevoegd! Welkom bij Pigeon Legends!');
                    
                    // Verberg de knop na gebruik
                    const startBtn = document.getElementById('startDuivenBtn');
                    if (startBtn) {
                        startBtn.style.display = 'none';
                    }
                    
                    // Toon demo duiven
                    toonDemoDuiven();
                } else {
                    alert('Er is een fout opgetreden: ' + error.message);
                }
            }
        }

        // Toon demo duiven als database niet beschikbaar is
        function toonDemoDuiven() {
            const lijst = document.getElementById('duiven-lijst');
            lijst.innerHTML = '';
            
            // Genereer 6 demo duiven
            for (let i = 0; i < 6; i++) {
                const demoDuif = genereerDuifProfiel();
                const totaalEigenschappen = berekenTotaalEigenschappen(demoDuif);
                const card = document.createElement('div');
                card.className = `duif-card ${demoDuif.geslacht}`;
                
                const geslachtIcon = demoDuif.geslacht === 'man' ? '♂️' : '♀️';
                const libidoDisplay = demoDuif.geslacht === 'man' ? renderLibido(demoDuif.libido || 0) : '';
                const duifFoto = demoDuif.geslacht === 'man' ? 'mannetje.png' : 'vrouwtje.png';
                
                card.innerHTML = `
                    <div class="duif-header">
                        <div class="duif-avatar">
                            <img src="${duifFoto}" alt="${demoDuif.geslacht === 'man' ? 'Mannetje' : 'Vrouwtje'} duif">
                        </div>
                        <div class="duif-info">
                            <h3>${demoDuif.naam}</h3>
                            <p>${demoDuif.geslacht === 'man' ? 'Mannetje' : 'Vrouwtje'} • ${demoDuif.leeftijd_maanden} maanden • ${demoDuif.status}</p>
                        </div>
                    </div>
                    
                    <div class="duif-stats">
                        <div class="stat-item">
                            <span class="stat-label">Vormpeil</span>
                            <span class="stat-value">${demoDuif.vormpeil || 0}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Snelheid</span>
                            <span class="stat-value">${demoDuif.snelheid || 0}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Conditie</span>
                            <span class="stat-value">${demoDuif.conditie || 0}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Orientatie</span>
                            <span class="stat-value">${demoDuif.orientatie || 0}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Techniek</span>
                            <span class="stat-value">${demoDuif.techniek || 0}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Ervaring</span>
                            <span class="stat-value">${demoDuif.ervaring || 0}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Aerodynamica</span>
                            <span class="stat-value">${demoDuif.aerodynamica || 0}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Intelligentie</span>
                            <span class="stat-value">${demoDuif.intelligentie || 0}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Nachtvliegen</span>
                            <span class="stat-value">${demoDuif.nachtvliegen || 0}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Totaal</span>
                            <span class="stat-value">${totaalEigenschappen}</span>
                        </div>
                    </div>
                    
                    ${libidoDisplay ? `<div style="margin-bottom: 1rem; text-align: center;">${libidoDisplay}</div>` : ''}
                    
                    
                `;
                
                lijst.appendChild(card);
            }
        }

        async function laadDuiven() {
            const lijst = document.getElementById('duiven-lijst');
            lijst.innerHTML = '<div class="loading">Laden...</div>';

            try {
                // Gebruik localStorage authenticatie
                const userEmail = localStorage.getItem('user_email');
                
                if (!userEmail) {
                    lijst.innerHTML = '<div class="error">❌ Je moet ingelogd zijn om je duiven te zien</div>';
                    return;
                }

                // Haal eerst de user_id op basis van email
                const { data: userData, error: userError } = await client
                    .from('users')
                    .select('id')
                    .eq('email', userEmail)
                    .single();
                
                if (userError || !userData) {
                    console.error('Gebruiker niet gevonden:', userError);
                    lijst.innerHTML = '<div class="error">❌ Gebruiker niet gevonden. Probeer opnieuw in te loggen.</div>';
                    return;
                }
                
                const userId = userData.id;

                const filterGeslacht = document.getElementById('filterGeslacht').value;
                const filterStatus = document.getElementById('filterStatus').value;
                const sortEigenschap = document.getElementById('sortEigenschap').value;

                let query = client
                    .from('duiven')
                    .select('*')
                    .eq('user_id', userId);

                // Filters toepassen
                if (filterGeslacht !== 'alle') {
                    query = query.eq('geslacht', filterGeslacht);
                }

                if (filterStatus !== 'alle') {
                    query = query.eq('status', filterStatus);
                }

                // Sortering toepassen
                if (sortEigenschap === 'created_at') {
                    query = query.order('created_at', { ascending: false });
                } else {
                    query = query.order(sortEigenschap, { ascending: false });
                }

                const { data: duiven, error } = await query;

                if (error) {
                    console.error('Database fout:', error);
                    if (error.message.includes('NetworkError') || error.message.includes('CORS')) {
                        // Toon demo duiven als database niet beschikbaar is
                        lijst.innerHTML = '<div class="loading">Database niet beschikbaar - Demo modus actief</div>';
                        setTimeout(() => {
                            toonDemoDuiven();
                        }, 1000);
                        return;
                    } else {
                        throw error;
                    }
                }

                if (!duiven || duiven.length === 0) {
                    lijst.innerHTML = '<div class="loading">Geen duiven gevonden. Klik op "Start met 6 Duiven" om te beginnen!</div>';
                    return;
                }

                lijst.innerHTML = '';

                duiven.forEach(duif => {
                    const totaalEigenschappen = berekenTotaalEigenschappen(duif);
                    const card = document.createElement('div');
                    card.className = `duif-card ${duif.geslacht}`;
                    
                    const geslachtIcon = duif.geslacht === 'man' ? '♂️' : '♀️';
                    const libidoDisplay = duif.geslacht === 'man' ? renderLibido(duif.libido || 0) : '';
                    const duifFoto = duif.geslacht === 'man' ? 'mannetje.png' : 'vrouwtje.png';
                    
                    card.innerHTML = `
                        <div class="duif-header">
                            <div class="duif-avatar">
                                <img src="${duifFoto}" alt="${duif.geslacht === 'man' ? 'Mannetje' : 'Vrouwtje'} duif">
                            </div>
                            <div class="duif-info">
                                <h3>${duif.naam}</h3>
                                <p>${duif.geslacht === 'man' ? 'Mannetje' : 'Vrouwtje'} • ${duif.leeftijd_maanden} maanden • ${duif.status}</p>
                            </div>
                        </div>
                        
                        <div class="duif-stats">
                            <div class="stat-item">
                                <span class="stat-label">Vormpeil</span>
                                <span class="stat-value">${duif.vormpeil || 0}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Snelheid</span>
                                <span class="stat-value">${duif.snelheid || 0}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Conditie</span>
                                <span class="stat-value">${duif.conditie || 0}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Orientatie</span>
                                <span class="stat-value">${duif.orientatie || 0}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Techniek</span>
                                <span class="stat-value">${duif.techniek || 0}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Ervaring</span>
                                <span class="stat-value">${duif.ervaring || 0}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Aerodynamica</span>
                                <span class="stat-value">${duif.aerodynamica || 0}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Intelligentie</span>
                                <span class="stat-value">${duif.intelligentie || 0}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Nachtvliegen</span>
                                <span class="stat-value">${duif.nachtvliegen || 0}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Totaal</span>
                                <span class="stat-value">${totaalEigenschappen}</span>
                            </div>
                        </div>
                        
                        ${libidoDisplay ? `<div style="margin-bottom: 1rem; text-align: center;">${libidoDisplay}</div>` : ''}
                        

                    `;
                    
                    lijst.appendChild(card);
                });
            } catch (error) {
                console.error('Fout bij laden duiven:', error);
                lijst.innerHTML = `<div class="error">❌ Er is een fout opgetreden: ${error.message}</div>`;
            }
        }

        // Controleer of start knop verborgen moet worden
        async function controleerStartKnop() {
            try {
                // Gebruik localStorage authenticatie
                const userEmail = localStorage.getItem('user_email');
                
                if (!userEmail) {
                    return; // Niet ingelogd, knop blijft zichtbaar
                }
                
                // Haal eerst de user_id op basis van email
                const { data: userData, error: userError } = await client
                    .from('users')
                    .select('id')
                    .eq('email', userEmail)
                    .single();
                
                if (userError || !userData) {
                    console.error('Gebruiker niet gevonden:', userError);
                    return; // Gebruiker niet gevonden, knop blijft zichtbaar
                }
                
                const userId = userData.id;
                
                const { data: bestaandeDuiven, error } = await client
                    .from('duiven')
                    .select('id')
                    .eq('user_id', userId)
                    .limit(1);
                
                if (error) {
                    console.error('Fout bij controleren start knop:', error);
                    // Als CORS fout, toon de knop
                    if (error.message.includes('NetworkError') || error.message.includes('CORS')) {
                        const startBtn = document.getElementById('startDuivenBtn');
                        if (startBtn) {
                            startBtn.style.display = 'inline-flex';
                        }
                    }
                    return;
                }
                
                if (bestaandeDuiven && bestaandeDuiven.length > 0) {
                    const startBtn = document.getElementById('startDuivenBtn');
                    if (startBtn) {
                        startBtn.style.display = 'none';
                    }
                } else {
                    // Toon de knop als gebruiker geen duiven heeft
                    const startBtn = document.getElementById('startDuivenBtn');
                    if (startBtn) {
                        startBtn.style.display = 'inline-flex';
                    }
                }
            } catch (error) {
                console.error('Fout bij controleren start knop:', error);
            }
        }

        // Event listeners
        document.getElementById('startDuivenBtn').addEventListener('click', maakStartDuiven);
        document.getElementById('filterGeslacht').addEventListener('change', laadDuiven);
        document.getElementById('filterStatus').addEventListener('change', laadDuiven);
        document.getElementById('sortEigenschap').addEventListener('change', laadDuiven);

        // Start de applicatie
        laadDuiven();
        controleerStartKnop();
    </script>
</body>
</html>


