<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Duiven Connectie</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body>
    <h1>Test Duiven Connectie</h1>
    <div id="status"></div>
    <div id="result"></div>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

        const SUPABASE_URL = 'https://ltwolxjbmdopjslnlkx.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_-hFbgnkMK4xn3uAaqJEuxA_C_9HAV6e';
        const client = createClient(SUPABASE_URL, SUPABASE_KEY);

        const statusDiv = document.getElementById('status');
        const resultDiv = document.getElementById('result');

        async function testConnectie() {
            statusDiv.innerHTML = '<p>üîç Testen van connectie...</p>';

            try {
                // Test 1: Controleer of gebruiker bestaat
                const userEmail = localStorage.getItem('user_email');
                statusDiv.innerHTML += `<p>üìß Gebruiker email: ${userEmail || 'Niet gevonden'}</p>`;

                if (!userEmail) {
                    resultDiv.innerHTML = '<p style="color: red;">‚ùå Geen gebruiker ingelogd</p>';
                    return;
                }

                // Test 2: Haal user_id op
                const { data: userData, error: userError } = await client
                    .from('users')
                    .select('id, email, naam, team_naam')
                    .eq('email', userEmail)
                    .single();

                if (userError) {
                    resultDiv.innerHTML = `<p style="color: red;">‚ùå Gebruiker niet gevonden: ${userError.message}</p>`;
                    return;
                }

                statusDiv.innerHTML += `<p>‚úÖ Gebruiker gevonden: ${userData.naam} (${userData.team_naam})</p>`;
                statusDiv.innerHTML += `<p>üÜî User ID: ${userData.id}</p>`;

                // Test 3: Controleer duiven
                const { data: duiven, error: duivenError } = await client
                    .from('duiven')
                    .select('id, naam, geslacht, leeftijd_maanden')
                    .eq('user_id', userData.id);

                if (duivenError) {
                    resultDiv.innerHTML = `<p style="color: red;">‚ùå Fout bij ophalen duiven: ${duivenError.message}</p>`;
                    return;
                }

                statusDiv.innerHTML += `<p>‚úÖ Duiven opgehaald: ${duiven.length} duiven gevonden</p>`;

                if (duiven.length === 0) {
                    resultDiv.innerHTML = '<p style="color: orange;">‚ö†Ô∏è Geen duiven gevonden. Klik op "Start met 6 Duiven" in de hoofdapp.</p>';
                } else {
                    resultDiv.innerHTML = '<p style="color: green;">‚úÖ Duiven gevonden!</p>';
                    resultDiv.innerHTML += '<h3>Jouw duiven:</h3>';
                    resultDiv.innerHTML += '<ul>';
                    duiven.forEach(duif => {
                        resultDiv.innerHTML += `<li>${duif.naam} (${duif.geslacht}, ${duif.leeftijd_maanden} maanden)</li>`;
                    });
                    resultDiv.innerHTML += '</ul>';
                }

            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red;">‚ùå Algemene fout: ${error.message}</p>`;
            }
        }

        // Start test
        testConnectie();
    </script>
</body>
</html> 